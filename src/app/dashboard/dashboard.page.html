<ion-content [fullscreen]="true">
  <app-cookie-banner></app-cookie-banner>

  <div class="scroll-wrapper">
    <div class="d-flex flex-row vh-100">
      <!-- Sidebar -->
      <app-sidebar [ngClass]="{ 'collapsed': collapsed }" (collapsedChange)="onSidebarChange($event)" [active]="0"></app-sidebar>

      <!-- Main Content -->
      <div [ngStyle]="{ 'margin-left.px': collapsed ? 80 : 250 }" class="width-main flex-fill p-4">
        <main class="container" style="margin-top: 128px;">

        <div *ngIf="tutorial" class="alert alert-warning alert-dismissible fade show" style="margin-bottom: 32px;" role="alert">
          <h4 class="alert-heading">Willkommen im Dashboard</h4>
          <p>Hier kommst du zu den einzelnen Navigationspunkten und siehst aktuelles. Navigiere zum Kundendashboard, Leadverwaltung oder deinem persönlichen Kalender.</p>
          <hr>
          <p class="mb-0">Schaue dir ansonsten gerne unser Erklärungsvideo an, um weitere Infos zu bekommen.</p>
          <!-- X Button -->
          <button (click)="closeTutorial()" type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>

          <!-- Skeleton Loading -->
          <ng-container *ngIf="isLoading; else actualContent">
            <!-- Top Cards -->
            <div class="row mb-4">
              <div class="col-12 col-md-6 mb-3 mb-md-0" *ngFor="let i of [1,2]">
                <div class="outer-card card p-3 h-100">
                  <div class="skeleton skeleton-text" style="width: 50%; height: 20px;"></div>
                  <div class="skeleton skeleton-text mt-2" style="width: 80%; height: 30px;"></div>
                  <div class="skeleton skeleton-button mt-3" style="width: 30%; height: 25px;"></div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-4">
              <div class="col-md-8">
                <div class="outer-card card p-3 border border-primary h-100">
                  <div class="skeleton skeleton-text" style="width: 60%; height: 25px;"></div>
                  <div class="skeleton skeleton-text mt-2" style="width: 100%; height: 200px;"></div>
                  <div class="skeleton skeleton-button mt-3" style="width: 40%; height: 25px;"></div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="outer-card card p-3 h-100">
                  <div class="skeleton skeleton-iframe" style="width: 100%; height: 280px;"></div>
                </div>
              </div>
            </div>

            <!-- Area Chart & Calendar -->
            <div class="row g-4 mt-4">
              <div class="col-md-6" *ngFor="let i of [1,2]">
                <div class="outer-card card p-3 h-100">
                  <div class="skeleton skeleton-text" style="width: 50%; height: 20px;"></div>
                  <div class="skeleton skeleton-text mt-2" style="width: 80%; height: 30px;"></div>
                  <div class="skeleton skeleton-button mt-3" style="width: 30%; height: 25px;"></div>
                </div>
              </div>
            </div>
          </ng-container>

          <!-- Actual Content -->
          <ng-template #actualContent>
            <!-- Top Cards -->
            <div class="row mb-4">
              <div class="col-12 col-md-6 mb-3 mb-md-0">
                <div class="outer-card card text-dark p-3 h-100">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="metric-card text-dark p-0 m-0" style="font-size: 1.5vh">Deine Email</div>
                  </div>
                  <div>
                    <p class="text-dark p-0 m-0" style="font-size: 2.3vh;">{{ user.email }}</p>
                    <button (click)="signOut()" class="btn btn-outline-danger mt-2 btn-sm">Abmelden</button>
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-6 mb-3 mb-md-0">
                <div class="outer-card card text-dark p-3 h-100">
                  <div class="d-flex justify-content-between align-items-center">
                    <div class="metric-card text-dark p-0 m-0" style="font-size: 1.5vh">Deine Organisation</div>
                  </div>
                  <div>
                    <p class="text-dark p-0 m-0" style="font-size: 2.3vh;">Comming Soon...</p>
                    <button class="btn btn-outline-secondary mt-2 btn-sm" disabled>Verwalten</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-4">
              <div class="col-md-6">
                <div class="metric-card outer-card card p-3 border border-primary">
                  <h5>Neuste Kunden</h5>
                  <div id="barChart" class="chart-placeholder mb-3" style="max-height: 250px; overflow-y: auto;">
                    <div *ngFor="let customer of customers">
                      <app-customer [customer]="customer"></app-customer>
                    </div>
                  </div>
                  <button class="btn btn-primary mt-3" (click)="openModal()">
                    Zum Kundendashboard
                  </button>
                </div>
              </div>
              <div class="col-md-6">
                <div class="metric-card outer-card card p-3 border border-primary">
                  <h5>Aktuelle Leads</h5>
                  <div id="barChart" class="chart-placeholder mb-3" style="max-height: 250px; overflow-y: auto;">
                    <div *ngFor="let customer of customers">
                      <app-customer [customer]="customer"></app-customer>
                    </div>
                  </div>
                  <button class="btn btn-primary mt-3" (click)="goToPage('lead-management')">
                    Zur Leadverwaltung
                  </button>
                </div>
              </div>
            </div>

            <!-- Area Chart & Calendar -->
            <div class="row g-4 mt-4 mb-4">
              <div class="col-md-6">
                <div class="metric-card outer-card card p-3 border border-primary bg-white">
                  

                  <h5>Nächste Termine</h5>

                  <!-- MINI CALENDAR -->
                  <div class="mini-calendar bg-white">
                    <div class="mini-cal-header bg-white">
                      <p>{{ currentDate | date:'MMMM yyyy' }}</p>
                    </div>

                    <div class="mini-cal-grid bg-white">
                      <div class="mini-day-name bg-white text-dark" *ngFor="let d of ['Mo','Di','Mi','Do','Fr','Sa','So']">{{ d }}</div>

                      <div class="mini-day bg-white" 
                          *ngFor="let day of miniCalendarDays"
                          [class.inactive]="!day.isCurrentMonth"
                          [class.today]="day.isToday">

                        <div class="mini-day-number text-dark">{{ day.date.getDate() }}</div>

                        <!-- Termine -->
                        <div class="mini-appt" *ngFor="let appt of day.appointments">
                          <span *ngIf="appt.deadline == 0">{{ appt.topic }}</span>
                          <span *ngIf="appt.deadline == 1" class="text-danger">Deadline</span>
                          <span *ngIf="appt.deadline == 2" class="text-warning">Request DL</span>
                        </div>

                      </div>
                    </div>
                  </div>

                  <button class="btn btn-primary mt-3" (click)="goToPage('calendar')">
                    <i class="bi bi-plus"></i> Zum Kalender
                  </button>




                </div>
              </div>
              <div class="col-md-6">
                <div class="metric-card outer-card card p-3">
                  <div style="width: 100%; height: 450px;">
                    <iframe 
                      src="https://www.youtube.com/embed/PMdzKu_60ic?si=hg-952OFh2P5WJo3" 
                      title="YouTube video player" 
                      frameborder="0" 
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                      allowfullscreen
                      style="width: 100%; height: 100%;"
                    ></iframe>
                  </div>
                </div>
              </div>
            </div>
          </ng-template>

        </main>
      </div>
    </div>
  </div>
</ion-content>
